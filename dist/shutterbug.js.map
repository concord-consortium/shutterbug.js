{"version":3,"file":"shutterbug.js","mappings":"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","sources":["webpack://Shutterbug/webpack/universalModuleDefinition","webpack://Shutterbug/./js/default-server.js","webpack://Shutterbug/./js/html-tools.js","webpack://Shutterbug/./js/replace-blobs-with-data-urls.js","webpack://Shutterbug/./js/shutterbug-worker.js","webpack://Shutterbug/external umd {\"root\":\"jQuery\",\"commonjs2\":\"jquery\",\"commonjs\":\"jquery\",\"amd\":\"jquery\"}","webpack://Shutterbug/webpack/bootstrap","webpack://Shutterbug/webpack/runtime/compat get default export","webpack://Shutterbug/webpack/runtime/define property getters","webpack://Shutterbug/webpack/runtime/hasOwnProperty shorthand","webpack://Shutterbug/webpack/runtime/make namespace object","webpack://Shutterbug/./js/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"jquery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"shutterbug\"] = factory(require(\"jquery\"));\n\telse\n\t\troot[\"Shutterbug\"] = factory(root[\"jQuery\"]);\n})(self, (__WEBPACK_EXTERNAL_MODULE_jquery__) => {\nreturn ","// Production:\nconst DEFAULT_SERVER = 'https://fh1fzvhx93.execute-api.us-east-1.amazonaws.com/production'\n// Staging:\n// const DEFAULT_SERVER = 'https://dgjr6g3z30.execute-api.us-east-1.amazonaws.com/staging'\n// Local:\n// const DEFAULT_SERVER = 'http://localhost:4000'\n\nexport default DEFAULT_SERVER\n","import $ from 'jquery'\n\nexport function cloneDomItem ($elem, elemTag) {\n  const $returnElm = $(elemTag)\n  $returnElm.addClass($elem.attr('class'))\n  $returnElm.attr('id', $elem.attr('id'))\n  $returnElm.attr('style', $elem.attr('style'))\n  $returnElm.css('background', $elem.css('background'))\n  $returnElm.attr('width', $elem.width())\n  $returnElm.attr('height', $elem.height())\n  return $returnElm\n}\n\n// element should be an instance of Canvas or Video element (element supported as an input to Canvas.drawImage method).\n// In some cases dataURL should be rescaled down to real size of the element (high DPI displays).\n// It doesn't make sense to send original data, as it might be really large and cause issues while rendering page on\n// AWS Lambda.\nexport function getDataURL (element) {\n  // Always use png to support transparent background.\n  const format = 'image/png'\n  const realWidth = $(element).width()\n  const realHeight = $(element).height()\n  // When element hasn't been added to DOM, realWidth and realHeight will be equal to 0.\n  const realDimensionsAvailable = realWidth > 0 && realHeight > 0\n  const widthAttr = Number($(element).attr('width')) || realWidth\n  const heightAttr = Number($(element).attr('height')) || realHeight\n  if (!realDimensionsAvailable || (realWidth === widthAttr && realHeight === heightAttr)) {\n    return element.toDataURL(format)\n  }\n  // Scale down image to its real size.\n  const canvas = document.createElement('canvas')\n  canvas.width = realWidth\n  canvas.height = realHeight\n  const ctx = canvas.getContext('2d')\n  // Other canvas or video element can be used as a source in .drawImage.\n  ctx.drawImage(element, 0, 0, realWidth, realHeight)\n  return canvas.toDataURL(format)\n}\n\nexport function generateFullHtmlFromFragment (fragment) {\n  return `\n    <!DOCTYPE html> \n    <html> \n    <head> \n      <base href=\"${fragment.base_url}\"> \n      <meta content=\"text/html;charset=utf-8\" http-equiv=\"Content-Type\"> \n      <title>content from ${fragment.base_url}</title> \n      ${fragment.css} \n    </head> \n      <body> \n        ${fragment.content} \n      </body> \n    </html>\n   `\n}\n","/* eslint-env browser */\nimport $ from 'jquery'\n\n// Downloads `blobURL` and provides object with mapping to dataURL format.\n// Async function, returns $.Deferred instance that will be resolved with the mapping.\nfunction convertBlobToDataURL (blobURL) {\n  const requestDeferred = new $.Deferred()\n  const xhr = new XMLHttpRequest()\n  xhr.onreadystatechange = function () {\n    if (this.readyState === 4 && this.status === 200) {\n      const reader = new FileReader()\n      reader.addEventListener('loadend', function () {\n        requestDeferred.resolve({blobURL, dataURL: reader.result})\n      })\n      reader.readAsDataURL(this.response)\n    }\n  }\n  xhr.open('GET', blobURL)\n  xhr.responseType = 'blob'\n  xhr.send()\n  return requestDeferred\n}\n\n// Converts all the blob URLs (e.g. \"blob:http://examples.com/abc-def-ghi\") in `htmlString` to data URLs.\n// Async function, returns $.Deferred instance that will be resolved with the final HTML.\nexport default function replaceBlobsWithDataURLs (htmlString) {\n  const deferred = new $.Deferred()\n  const blobURLs = htmlString.match(/[\"']blob:.*?[\"']/gi)\n  if (blobURLs === null) {\n    // Nothing to do.\n    deferred.resolve(htmlString)\n    return deferred\n  }\n\n  const blobRequests = blobURLs\n    // .slice(1, -1) removes \" or ' from the URI.\n    .map(blobURLWithQuotes => blobURLWithQuotes.slice(1, -1))\n    .map(blobURL => convertBlobToDataURL(blobURL))\n\n  $.when.apply($, blobRequests).done(function () {\n    // Convert arguments to real Array instance.\n    const mappings = Array.prototype.slice.call(arguments)\n    let newHtmlString = htmlString\n    mappings.forEach(mapping => {\n      newHtmlString = newHtmlString.replace(mapping.blobURL, mapping.dataURL)\n    })\n    deferred.resolve(newHtmlString)\n  })\n\n  return deferred\n}\n","import $ from 'jquery'\nimport { generateFullHtmlFromFragment, cloneDomItem, getDataURL } from './html-tools'\nimport replaceBlobsWithDataURLs from './replace-blobs-with-data-urls'\nimport DEFAULT_SERVER from './default-server'\n\nconst MAX_TIMEOUT = 1500\n// Shutterbug backend URL can be overwritten for testing using SERVER_URL_PARAM_NAME query param.\n// Eg ?shutterbugUrl=https://dgjr6g3z30.execute-api.us-east-1.amazonaws.com/staging\nconst SERVER_URL_PARAM_NAME = \"shutterbugUrl\"\n\n// Each shutterbug instance on a single page requires unique ID (iframe-iframe communication).\nlet _id = 0\n\nfunction getID () {\n  return _id++\n}\n\nfunction getURLParam(name) {\n  const url = (self || window).location.href;\n  name = name.replace(/[[]]/g, \"\\\\$&\");\n  const regex = new RegExp(`[#?&]${name}(=([^&#]*)|&|#|$)`);\n  const results = regex.exec(url);\n  if (!results) return null;\n  if (!results[2]) return true;\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nfunction getCSSString () {\n  // originally this was\n  // $('<div>').append($('link[rel=\"stylesheet\"]').clone()).append($('style').clone()).html()\n  // but that missed any rules added with insertRule\n\n  // start out the result with all of the remote style sheets\n  let result = $('<div>').append($('link[rel=\"stylesheet\"]').clone())\n\n  // document.styleSheets[1].cssRules[0].cssText\n  for(let i=0; i<document.styleSheets.length; i++) {\n    let sheet = document.styleSheets[i]\n\n    // skip the sheets that are <link.. elements\n    if(sheet.href !== null) {\n      continue\n    }\n\n    var cssText = \"\"\n    var styleElement = $('<style>').attr('type',sheet.type)\n    for(let j=0; j<sheet.cssRules.length; j++){\n      styleElement.append(sheet.cssRules[j].cssText + \"\\n\")\n    }\n    result.append(styleElement)\n  }\n\n  return result.html()\n}\n\nexport default class ShutterbugWorker {\n  constructor (options) {\n    const opt = options || {}\n\n    if (!opt.selector) {\n      throw new Error('missing required option: selector')\n    }\n\n    // Remember that selector is anything accepted by jQuery, it can be DOM element too.\n    this.element = opt.selector\n    this.callback = opt.done\n    this.failCallback = opt.fail\n    this.alwaysCallback = opt.always\n    this.imgDst = opt.dstSelector\n    this.server = getURLParam(SERVER_URL_PARAM_NAME) || opt.server || DEFAULT_SERVER\n\n    this.id = getID()\n    this.iframeReqTimeout = MAX_TIMEOUT\n\n    // Bind and save a new function, so it works well with .add/removeEventListener().\n    this._postMessageHandler = this._postMessageHandler.bind(this)\n  }\n\n  enableIframeCommunication () {\n    $(document).ready(() => {\n      window.addEventListener('message', this._postMessageHandler, false)\n    })\n  }\n\n  disableIframeCommunication () {\n    window.removeEventListener('message', this._postMessageHandler, false)\n  }\n\n\n  getDomSnapshot () {\n    this.enableIframeCommunication() // !!!\n    let timerID = null\n    if (this.imgDst) {\n      // Start timer and update destination element.\n      let time = 0\n      const counter = $('<span>')\n      counter.html(time)\n      $(this.imgDst).html('Creating snapshot: ').append(counter)\n      timerID = setInterval(() => {\n        time = time + 1\n        counter.html(time)\n      }, 1000)\n    }\n    // Ask for HTML fragment and render it on server.\n    this.getHtmlFragment(htmlData => {\n      $.ajax({\n        url: this.server + '/make-snapshot',\n        type: 'POST',\n        data: JSON.stringify(htmlData)\n      }).done(msg => {\n        if (this.callback) {\n          this.callback(msg.url)\n        }\n        if (this.imgDst) {\n          $(this.imgDst).html(`<img src=${msg.url}>`)\n        }\n      }).fail((jqXHR, textStatus, errorThrown) => {\n        if (this.failCallback) {\n          this.failCallback(jqXHR, textStatus, errorThrown)\n        }\n        if (this.imgDst) {\n          $(this.imgDst).html(`Snapshot failed`)\n        }\n        console.error(textStatus, errorThrown)\n      }).always(() => {\n        clearInterval(timerID)\n        this.disableIframeCommunication() // !!!\n        if (this.alwaysCallback) {\n          this.alwaysCallback()\n        }\n      })\n    })\n  }\n\n  // Most important method. Returns HTML, CSS and dimensions of the snapshot.\n  getHtmlFragment (callback) {\n    const self = this\n    const $element = $(self.element)\n\n    // .find('iframe').addBack(\"iframe\") handles two cases:\n    // - element itself is an iframe - .addBack('iframe')\n    // - element descendants are iframes - .find('iframe')\n    const $iframes = $element.find('iframe').addBack('iframe')\n    this._iframeContentRequests = []\n    $iframes.each((i, iframeElem) => {\n      // Note that position of the iframe is used as its ID.\n      this._postHtmlFragRequestToIframe(iframeElem, i)\n    })\n\n    // Continue when we receive responses from all the nested iframes.\n    // Nested iframes descriptions will be provided as arguments.\n    $.when.apply($, this._iframeContentRequests).done(function () {\n      $element.trigger('shutterbug-saycheese')\n\n      let clonedElement = $element.clone()\n\n      // remove all script elements from the clone we don't want the html fragment\n      // changing itself\n      clonedElement.find('script').remove()\n\n      // Nested iframes.\n      if (arguments.length > 0) {\n        const nestedIFrames = arguments\n        // This supports two cases:\n        // - clonedElement itself is an iframe - .addBack('iframe')\n        // - clonedElement descendants are iframes - .find('iframe')\n        clonedElement.find('iframe').addBack('iframe').each(function (i, iframeElem) {\n          // When iframe doesn't support Shutterbug, request will timeout and null will be received.\n          // In such case just ignore this iframe, we won't be able to render it.\n          if (nestedIFrames[i] == null) return\n          $(iframeElem).attr('srcdoc', generateFullHtmlFromFragment(nestedIFrames[i]))\n        })\n      }\n\n      // Canvases.\n      // .addBack('canvas') handles case when the clonedElement itself is a canvas.\n      const replacementCanvasImgs = $element.find('canvas').addBack('canvas').map(function (i, elem) {\n        const dataUrl = getDataURL(elem)\n        const img = cloneDomItem($(elem), '<img>')\n        img.attr('src', dataUrl)\n        return img\n      })\n\n      if (clonedElement.is('canvas')) {\n        clonedElement = replacementCanvasImgs[0]\n      } else {\n        clonedElement.find('canvas').each((i, elem) => {\n          $(elem).replaceWith(replacementCanvasImgs[i])\n        })\n      }\n\n      // Video elements.\n      // .addBack('video') handles case when the clonedElement itself is a video.\n      const replacementVideoImgs = []\n      $element.find('video').addBack('video').map((i, elem) => {\n        const $elem = $(elem)\n        const canvas = cloneDomItem($elem, '<canvas>')\n        canvas[0].getContext('2d').drawImage(elem, 0, 0, $elem.width(), $elem.height())\n        try {\n          const dataUrl = getDataURL(canvas[0])\n          const img = cloneDomItem($elem, '<img>')\n          img.attr('src', dataUrl)\n          replacementVideoImgs.push(img)\n        } catch (e) {\n          // If the video isn't hosted on the same site this will catch the security error\n          // and push null to signal it doesn't need replacing.  We don't use the return\n          // value of map() as returning null confuses jQuery.\n          replacementVideoImgs.push(null)\n        }\n      })\n\n      if (clonedElement.is('video')) {\n        if (replacementVideoImgs[0]) {\n          clonedElement = replacementVideoImgs[0]\n        }\n      } else {\n        clonedElement.find('video').each(function (i, elem) {\n          if (replacementVideoImgs[i]) {\n            $(elem).replaceWith(replacementVideoImgs[i])\n          }\n        })\n      }\n\n      clonedElement.css({\n        // Make sure that clonedElement will be positioned in the top-left corner of the viewport.\n        'top': 0,\n        'left': 0,\n        'transform': 'translate3d(0, 0, 0)',\n        'margin': 0,\n        // Dimensions need to be set explicitly (e.g. otherwise 50% width wouldn't work as expected).\n        'width': $element.width(),\n        'height': $element.height()\n      })\n\n      const htmlString = $('<div>').append(clonedElement).html()\n      const cssString = getCSSString()\n      // Process HTML and CSS content when it's a string. Some operations are easier when we can use regular expressions\n      // instead of traversing the DOM using jQuery.\n      const htmlDeferred = replaceBlobsWithDataURLs(htmlString)\n      const cssDeferred = replaceBlobsWithDataURLs(cssString)\n      $.when(htmlDeferred, cssDeferred).done(function (processedHTMLString, processedCssString) {\n        const htmlData = {\n          content: processedHTMLString,\n          css: processedCssString,\n          width: $element.outerWidth(),\n          height: $element.outerHeight(),\n          base_url: window.location.href\n        }\n\n        $element.trigger('shutterbug-asyouwere')\n\n        callback(htmlData)\n      })\n    })\n  }\n\n  // frame-iframe communication related methods:\n\n  // Basic post message handler.\n  _postMessageHandler (message) {\n    function handleMessage (message, type, handler) {\n      let data = message.data\n      if (typeof data === 'string') {\n        try {\n          data = JSON.parse(data)\n          if (data.type === type) {\n            handler(data, message.source)\n          }\n        } catch (e) {\n          // Not a json message. Ignore it. We only speak json.\n        }\n      }\n    }\n\n    handleMessage(message, 'htmlFragRequest', this._htmlFragRequestHandler.bind(this))\n    handleMessage(message, 'htmlFragResponse', this._htmlFragResponseHandler.bind(this))\n  }\n\n  // Iframe receives question about its content.\n  _htmlFragRequestHandler (data, source) {\n    // Update timeout. When we receive a request from parent, we have to finish nested iframes\n    // rendering in that time. Otherwise parent rendering will timeout.\n    // Backward compatibility: Shutterbug v0.1.x don't send iframeReqTimeout.\n    this.iframeReqTimeout = data.iframeReqTimeout != null ? data.iframeReqTimeout : MAX_TIMEOUT\n    this.getHtmlFragment(function (html) {\n      const response = {\n        type: 'htmlFragResponse',\n        value: html,\n        iframeReqId: data.iframeReqId,\n        id: data.id // return to sender only\n      }\n      source.postMessage(JSON.stringify(response), '*')\n    })\n  }\n\n  // Parent receives content from iframes.\n  _htmlFragResponseHandler (data) {\n    if (data.id === this.id) {\n      // Backward compatibility: Shutterbug v0.1.x don't send iframeReqId.\n      const iframeReqId = data.iframeReqId != null ? data.iframeReqId : 0\n      this._iframeContentRequests[iframeReqId].resolve(data.value)\n    }\n  }\n\n  // Parent asks iframes about their content.\n  _postHtmlFragRequestToIframe (iframeElem, iframeId) {\n    const message = {\n      type: 'htmlFragRequest',\n      id: this.id,\n      iframeReqId: iframeId,\n      // We have to provide smaller timeout while sending message to nested iframes.\n      // Otherwise, when one of the nested iframes timeouts, then all will do the\n      // same and we won't render anything - even iframes that support Shutterbug.\n      iframeReqTimeout: this.iframeReqTimeout * 0.6\n    }\n    iframeElem.contentWindow.postMessage(JSON.stringify(message), '*')\n    const requestDeferred = new $.Deferred()\n    this._iframeContentRequests[iframeId] = requestDeferred\n    setTimeout(function () {\n      // It handles a situation in which iframe doesn't support Shutterbug.\n      // When we doesn't receive answer for some time, assume that we can't\n      // render this particular iframe (provide null as iframe description).\n      if (requestDeferred.state() !== 'resolved') {\n        requestDeferred.resolve(null)\n      }\n    }, this.iframeReqTimeout)\n  }\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE_jquery__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import $ from 'jquery'\nimport ShutterbugWorker from './shutterbug-worker'\n\n// Used by enable and disable functions.\nlet iframeWorker = null\n\nfunction parseSnapshotArguments (args) {\n  // Remember that selector is anything accepted by jQuery, it can be DOM element too.\n  let selector\n  let doneCallback\n  let dstSelector\n  let options = {}\n\n  function assignSecondArgument (arg) {\n    if (typeof arg === 'string') { dstSelector = arg } else if (typeof arg === 'function') { doneCallback = arg } else if (typeof arg === 'object') { options = arg }\n  }\n\n  if (args.length === 3) {\n    options = args[2]\n    assignSecondArgument(args[1])\n    selector = args[0]\n  } else if (args.length === 2) {\n    assignSecondArgument(args[1])\n    selector = args[0]\n  } else if (args.length === 1) {\n    options = args[0]\n  }\n  if (selector) { options.selector = selector }\n  if (doneCallback) { options.done = doneCallback }\n  if (dstSelector) { options.dstSelector = dstSelector }\n  return options\n}\n\n// Public API:\nexport default {\n  snapshot () {\n    const options = parseSnapshotArguments(arguments)\n    const shutterbugWorker = new ShutterbugWorker(options)\n    shutterbugWorker.getDomSnapshot()\n  },\n\n  enable (selector) {\n    this.disable()\n    selector = selector || 'body'\n    iframeWorker = new ShutterbugWorker({selector: selector})\n    iframeWorker.enableIframeCommunication()\n  },\n\n  disable () {\n    if (iframeWorker) {\n      iframeWorker.disableIframeCommunication()\n      iframeWorker = null\n    }\n  },\n\n  // Supported events:\n  // 'saycheese' - triggered before snapshot is taken\n  // 'asyouwere' - triggered after snapshot is taken\n  on (event, handler) {\n    $(window).on('shutterbug-' + event, handler)\n  },\n\n  off (event, handler) {\n    $(window).off('shutterbug-' + event, handler)\n  }\n}\n"],"names":["DEFAULT_SERVER","$","cloneDomItem","$elem","elemTag","$returnElm","addClass","attr","css","width","height","getDataURL","element","format","realWidth","realHeight","realDimensionsAvailable","widthAttr","Number","heightAttr","toDataURL","canvas","document","createElement","ctx","getContext","drawImage","generateFullHtmlFromFragment","fragment","base_url","content","convertBlobToDataURL","blobURL","requestDeferred","Deferred","xhr","XMLHttpRequest","onreadystatechange","readyState","status","reader","FileReader","addEventListener","resolve","dataURL","result","readAsDataURL","response","open","responseType","send","replaceBlobsWithDataURLs","htmlString","deferred","blobURLs","match","blobRequests","map","blobURLWithQuotes","slice","when","apply","done","mappings","Array","prototype","call","arguments","newHtmlString","forEach","mapping","replace","MAX_TIMEOUT","SERVER_URL_PARAM_NAME","_id","getID","getURLParam","name","url","self","window","location","href","regex","RegExp","results","exec","decodeURIComponent","getCSSString","append","clone","i","styleSheets","length","sheet","cssText","styleElement","type","j","cssRules","html","ShutterbugWorker","options","opt","selector","Error","callback","failCallback","fail","alwaysCallback","always","imgDst","dstSelector","server","id","iframeReqTimeout","_postMessageHandler","bind","ready","removeEventListener","enableIframeCommunication","timerID","time","counter","setInterval","getHtmlFragment","htmlData","ajax","data","JSON","stringify","msg","jqXHR","textStatus","errorThrown","console","error","clearInterval","disableIframeCommunication","$element","$iframes","find","addBack","_iframeContentRequests","each","iframeElem","_postHtmlFragRequestToIframe","trigger","clonedElement","remove","nestedIFrames","replacementCanvasImgs","elem","dataUrl","img","is","replaceWith","replacementVideoImgs","push","e","cssString","htmlDeferred","cssDeferred","processedHTMLString","processedCssString","outerWidth","outerHeight","message","handleMessage","handler","parse","source","_htmlFragRequestHandler","_htmlFragResponseHandler","value","iframeReqId","postMessage","iframeId","contentWindow","setTimeout","state","iframeWorker","parseSnapshotArguments","args","doneCallback","assignSecondArgument","arg","snapshot","shutterbugWorker","getDomSnapshot","enable","disable","on","event","off"],"sourceRoot":""}