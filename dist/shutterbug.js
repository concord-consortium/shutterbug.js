!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?exports.shutterbug=t(require("jquery")):e.Shutterbug=t(e.jQuery)}(window,(function(e){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=o(n(0)),i=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var u=null;function l(e){var t=void 0,n=void 0,r=void 0,i={};function o(e){"string"==typeof e?r=e:"function"==typeof e?n=e:"object"===(void 0===e?"undefined":a(e))&&(i=e)}return 3===e.length?(i=e[2],o(e[1]),t=e[0]):2===e.length?(o(e[1]),t=e[0]):1===e.length&&(i=e[0]),t&&(i.selector=t),n&&(i.done=n),r&&(i.dstSelector=r),i}t.default={snapshot:function(){var e=l(arguments),t=new i.default(e);t.getDomSnapshot()},enable:function(e){this.disable(),e=e||"body",(u=new i.default({selector:e})).enableIframeCommunication()},disable:function(){u&&(u.disableIframeCommunication(),u=null)},on:function(e,t){(0,r.default)(window).on("shutterbug-"+e,t)},off:function(e,t){(0,r.default)(window).off("shutterbug-"+e,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=l(n(0)),i=n(3),o=l(n(4)),u=l(n(5));function l(e){return e&&e.__esModule?e:{default:e}}var s=0;function f(){for(var e=(0,r.default)("<div>").append((0,r.default)('link[rel="stylesheet"]').clone()),t=0;t<document.styleSheets.length;t++){var n=document.styleSheets[t];if(null===n.href){for(var a=(0,r.default)("<style>").attr("type",n.type),i=0;i<n.cssRules.length;i++)a.append(n.cssRules[i].cssText+"\n");e.append(a)}}return e.html()}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t||{};if(!n.selector)throw new Error("missing required option: selector");this.element=n.selector,this.callback=n.done,this.failCallback=n.fail,this.alwaysCallback=n.always,this.imgDst=n.dstSelector,this.server=n.server||u.default,this.id=s++,this.iframeReqTimeout=1500,this._postMessageHandler=this._postMessageHandler.bind(this)}return a(e,[{key:"enableIframeCommunication",value:function(){var e=this;(0,r.default)(document).ready((function(){window.addEventListener("message",e._postMessageHandler,!1)}))}},{key:"disableIframeCommunication",value:function(){window.removeEventListener("message",this._postMessageHandler,!1)}},{key:"getDomSnapshot",value:function(){var e=this;this.enableIframeCommunication();var t=null;if(this.imgDst){var n=0,a=(0,r.default)("<span>");a.html(n),(0,r.default)(this.imgDst).html("Creating snapshot: ").append(a),t=setInterval((function(){n+=1,a.html(n)}),1e3)}this.getHtmlFragment((function(n){r.default.ajax({url:e.server+"/make-snapshot",type:"POST",data:JSON.stringify(n)}).done((function(t){e.callback&&e.callback(t.url),e.imgDst&&(0,r.default)(e.imgDst).html("<img src="+t.url+">")})).fail((function(t,n,a){e.failCallback&&e.failCallback(t,n,a),e.imgDst&&(0,r.default)(e.imgDst).html("Snapshot failed"),console.error(n,a)})).always((function(){clearInterval(t),e.disableIframeCommunication(),e.alwaysCallback&&e.alwaysCallback()}))}))}},{key:"getHtmlFragment",value:function(e){var t=this,n=(0,r.default)(this.element),a=n.find("iframe").addBack("iframe");this._iframeContentRequests=[],a.each((function(e,n){t._postHtmlFragRequestToIframe(n,e)})),r.default.when.apply(r.default,this._iframeContentRequests).done((function(){n.trigger("shutterbug-saycheese");var t=n.clone();if(t.find("script").remove(),arguments.length>0){var a=arguments;t.find("iframe").addBack("iframe").each((function(e,t){null!=a[e]&&(0,r.default)(t).attr("srcdoc",(0,i.generateFullHtmlFromFragment)(a[e]))}))}var u=n.find("canvas").addBack("canvas").map((function(e,t){var n=(0,i.getDataURL)(t),a=(0,i.cloneDomItem)((0,r.default)(t),"<img>");return a.attr("src",n),a}));t.is("canvas")?t=u[0]:t.find("canvas").each((function(e,t){(0,r.default)(t).replaceWith(u[e])}));var l=[];n.find("video").addBack("video").map((function(e,t){var n=(0,r.default)(t),a=(0,i.cloneDomItem)(n,"<canvas>");a[0].getContext("2d").drawImage(t,0,0,n.width(),n.height());try{var o=(0,i.getDataURL)(a[0]),u=(0,i.cloneDomItem)(n,"<img>");u.attr("src",o),l.push(u)}catch(e){l.push(null)}})),t.is("video")?l[0]&&(t=l[0]):t.find("video").each((function(e,t){l[e]&&(0,r.default)(t).replaceWith(l[e])})),t.css({top:0,left:0,transform:"translate3d(0, 0, 0)",margin:0,width:n.width(),height:n.height()});var s=(0,r.default)("<div>").append(t).html(),d=f(),c=(0,o.default)(s),m=(0,o.default)(d);r.default.when(c,m).done((function(t,a){var r={content:t,css:a,width:n.outerWidth(),height:n.outerHeight(),base_url:window.location.href};n.trigger("shutterbug-asyouwere"),e(r)}))}))}},{key:"_postMessageHandler",value:function(e){function t(e,t,n){var a=e.data;if("string"==typeof a)try{(a=JSON.parse(a)).type===t&&n(a,e.source)}catch(e){}}t(e,"htmlFragRequest",this._htmlFragRequestHandler.bind(this)),t(e,"htmlFragResponse",this._htmlFragResponseHandler.bind(this))}},{key:"_htmlFragRequestHandler",value:function(e,t){this.iframeReqTimeout=null!=e.iframeReqTimeout?e.iframeReqTimeout:1500,this.getHtmlFragment((function(n){var a={type:"htmlFragResponse",value:n,iframeReqId:e.iframeReqId,id:e.id};t.postMessage(JSON.stringify(a),"*")}))}},{key:"_htmlFragResponseHandler",value:function(e){if(e.id===this.id){var t=null!=e.iframeReqId?e.iframeReqId:0;this._iframeContentRequests[t].resolve(e.value)}}},{key:"_postHtmlFragRequestToIframe",value:function(e,t){var n={type:"htmlFragRequest",id:this.id,iframeReqId:t,iframeReqTimeout:.6*this.iframeReqTimeout};e.contentWindow.postMessage(JSON.stringify(n),"*");var a=new r.default.Deferred;this._iframeContentRequests[t]=a,setTimeout((function(){"resolved"!==a.state()&&a.resolve(null)}),this.iframeReqTimeout)}}]),e}();t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cloneDomItem=function(e,t){var n=(0,i.default)(t);return n.addClass(e.attr("class")),n.attr("id",e.attr("id")),n.attr("style",e.attr("style")),n.css("background",e.css("background")),n.attr("width",e.width()),n.attr("height",e.height()),n},t.getDataURL=function(e){var t=(0,i.default)(e).width(),n=(0,i.default)(e).height(),a=t>0&&n>0,r=Number((0,i.default)(e).attr("width"))||t,o=Number((0,i.default)(e).attr("height"))||n;if(!a||t===r&&n===o)return e.toDataURL("image/png");var u=document.createElement("canvas");return u.width=t,u.height=n,u.getContext("2d").drawImage(e,0,0,t,n),u.toDataURL("image/png")},t.generateFullHtmlFromFragment=function(e){return'\n    <!DOCTYPE html> \n    <html> \n    <head> \n      <base href="'+e.base_url+'"> \n      <meta content="text/html;charset=utf-8" http-equiv="Content-Type"> \n      <title>content from '+e.base_url+"</title> \n      "+e.css+" \n    </head> \n      <body> \n        "+e.content+" \n      </body> \n    </html>\n   "};var a,r=n(0),i=(a=r)&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=new i.default.Deferred,n=e.match(/["']blob:.*?["']/gi);if(null===n)return t.resolve(e),t;var a=n.map((function(e){return e.slice(1,-1)})).map((function(e){return function(e){var t=new i.default.Deferred,n=new XMLHttpRequest;return n.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var n=new FileReader;n.addEventListener("loadend",(function(){t.resolve({blobURL:e,dataURL:n.result})})),n.readAsDataURL(this.response)}},n.open("GET",e),n.responseType="blob",n.send(),t}(e)}));return i.default.when.apply(i.default,a).done((function(){var n=Array.prototype.slice.call(arguments),a=e;n.forEach((function(e){a=a.replace(e.blobURL,e.dataURL)})),t.resolve(a)})),t};var a,r=n(0),i=(a=r)&&a.__esModule?a:{default:a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default="https://fh1fzvhx93.execute-api.us-east-1.amazonaws.com/production"}]).default}));