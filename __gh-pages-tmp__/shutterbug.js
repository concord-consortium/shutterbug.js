!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},r={},i=function(t,e){return{}.hasOwnProperty.call(t,e)},a=function(t,e){var r,i,a=[];r=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var n=0,s=r.length;s>n;n++)i=r[n],".."===i?a.pop():"."!==i&&""!==i&&a.push(i);return a.join("/")},n=function(t){return t.split("/").slice(0,-1).join("/")},s=function(e){return function(r){var i=n(e),s=a(i,r);return t.require(s,e)}},o=function(t,e){var i={id:t,exports:{}};return r[t]=i,e(i.exports,s(t),i),i.exports},l=function(t,n){var s=a(t,".");if(null==n&&(n="/"),i(r,s))return r[s].exports;if(i(e,s))return o(s,e[s]);var l=a(s,"./index");if(i(r,l))return r[l].exports;if(i(e,l))return o(l,e[l]);throw new Error('Cannot find module "'+t+'" from "'+n+'"')},u=function(t,r){if("object"==typeof t)for(var a in t)i(t,a)&&(e[a]=t[a]);else e[t]=r},c=function(){var t=[];for(var r in e)i(e,r)&&t.push(r);return t};t.require=l,t.require.define=u,t.require.register=u,t.require.list=c,t.require.brunch=!0}}(),require.register("scripts/default-server",function(t,e,r){r.exports="//shutterbug.herokuapp.com/shutterbug"}),require.register("scripts/html-tools",function(t,e,r){var i=jQuery;r.exports={cloneDomItem:function(t,e){var r=i(e);return r.addClass(t.attr("class")),r.attr("style",t.attr("style")),r.css("background",t.css("background")),r.attr("width",t.width()),r.attr("height",t.height()),returnElm},generateFullHtmlFromFragment:function(t){return"<!DOCTYPE html><html><head><base href='"+t.base_url+"'><meta content='text/html;charset=utf-8' http-equiv='Content-Type'><title>content from "+t.base_url+"</title>"+t.css+"</head><body>"+t.content+"</body></html>"},dataURLtoBlob:function(t){if(-1===t.split(",")[0].indexOf("base64"))throw new Error("expected base64 data");for(var e=atob(t.split(",")[1]),r=t.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(e.length),a=0;a<e.length;a++)i[a]=e.charCodeAt(a);return new Blob([i],{type:r})}}}),require.register("scripts/shutterbug-worker",function(t,e,r){function i(){return c++}function a(t){var e=t||{};if(!e.selector)throw new Error("missing required option: selector");this.element=e.selector,this.callback=e.done,this.failCallback=e.fail,this.alwaysCallback=e.always,this.imgDst=e.dstSelector,this.server=e.server||o,this.imageFormat=e.format||"png",this.imageQuality=e.quality||1,this._useIframeSizeHack=e.useIframeSizeHack,this.id=i(),this.iframeReqTimeout=l,this._postMessageHandler=this._postMessageHandler.bind(this)}var n=jQuery,s=e("scripts/html-tools"),o=e("scripts/default-server"),l=1500,u="function"==typeof window.Blob&&"function"==typeof window.Uint8Array,c=0;a.prototype.enableIframeCommunication=function(){n(document).ready(function(){window.addEventListener("message",this._postMessageHandler,!1)}.bind(this))},a.prototype.disableIframeCommunication=function(){window.removeEventListener("message",this._postMessageHandler,!1)},a.prototype.getHtmlFragment=function(t){var e=this,r=n(this.element),i=r.find("iframe").addBack("iframe");this._iframeContentRequests=[],i.each(function(t,r){e._postHtmlFragRequestToIframe(r,t)}),n.when.apply(n,this._iframeContentRequests).done(function(){r.trigger("shutterbug-saycheese");var i=n("<div>").append(n('link[rel="stylesheet"]').clone()).append(n("style").clone()).html(),a=r.width(),o=r.height(),l=r.clone();if(l.find("script").remove(),arguments.length>0){var u=arguments;l.find("iframe").addBack("iframe").each(function(t,e){null!=u[t]&&n(e).attr("src","data:text/html,"+s.generateFullHtmlFromFragment(u[t]))})}var c=r.find("canvas").addBack("canvas").map(function(t,e){var r=e.toDataURL("image/png"),i=s.cloneDomItem(n(e),"<img>");return i.attr("src",r),i});l.is("canvas")?l=c[0]:l.find("canvas").each(function(t,e){n(e).replaceWith(c[t])}),l.css({top:0,left:0,margin:0,width:a,height:o}),e._useIframeSizeHack&&(a=10);var h={content:n("<div>").append(l).html(),css:i,width:a,height:o,base_url:window.location.href};r.trigger("shutterbug-asyouwere"),t(h)})},a.prototype.getDomSnapshot=function(){this.enableIframeCommunication();var t=this,e=0,r=n("<span>");r.html(e),n(t.imgDst).html("creating snapshot: ").append(r),this.timer=setInterval(function(){e+=1,r.html(e)},1e3);var i=n(this.element).prop("tagName");switch(i){case"CANVAS":this.canvasSnapshot();break;default:this.basicSnapshot()}},a.prototype.canvasSnapshot=function(){if(!u)return this.basicSnapshot();var t=this;n.ajax({type:"GET",url:this.server+"/img_upload_url?format="+this.imageFormat}).done(function(e){t.directUpload(e)}).fail(function(){t.basicSnapshot()})},a.prototype.directUpload=function(t){var e=n(this.element),r=e[0].toDataURL("image/"+this.imageFormat,this.imageQuality),i=s.dataURLtoBlob(r),a=this;n.ajax({type:"PUT",url:t.put_url,data:i,processData:!1,contentType:!1}).done(function(){a._successHandler("<img src="+t.get_url+">")}).fail(function(t,e,r){a._failHandler(t,e,r)}).always(function(){a._alwaysHandler()})},a.prototype.basicSnapshot=function(){var t=this;this.getHtmlFragment(function(e){e.format=t.imageFormat,e.quality=t.imageQuality,n.ajax({url:t.server+"/make_snapshot",type:"POST",data:e}).done(function(e){t._successHandler(e)}).fail(function(e,r,i){t._failHandler(e,r,i)}).always(function(){t._alwaysHandler()})})},a.prototype._successHandler=function(t){if(this.imgDst&&n(this.imgDst).html(t),this.callback){var e=t.match(/src='([^']*)'/)[1];this.callback(e)}},a.prototype._failHandler=function(t,e,r){this.imgDst&&n(this.imgDst).html("snapshot failed"),this.failCallback&&this.failCallback(t,e,r)},a.prototype._alwaysHandler=function(){clearInterval(this.timer),this.disableIframeCommunication(),this.alwaysCallback&&this.alwaysCallback()},a.prototype.htmlSnap=function(){this.getHtmlFragment(function(t){var e=btoa(s.generateFullHtmlFromFragment(t));window.open("data:text/html;base64,"+e)})},a.prototype.imageSnap=function(){var t=this.imgDst,e=this.callback,r=this;this.imgDst=null,this.callback=function(i){window.open(i),r.imgDst=t,r.callback=e},this.getDomSnapshot()},a.prototype._postMessageHandler=function(t){function e(t,e,r){var i=t.data;if("string"==typeof i)try{i=JSON.parse(i),i.type===e&&r(i,t.source)}catch(a){}}e(t,"htmlFragRequest",this._htmlFragRequestHandler.bind(this)),e(t,"htmlFragResponse",this._htmlFragResponseHandler.bind(this))},a.prototype._htmlFragRequestHandler=function(t,e){this.iframeReqTimeout=null!=t.iframeReqTimeout?t.iframeReqTimeout:l,this.getHtmlFragment(function(r){var i={type:"htmlFragResponse",value:r,iframeReqId:t.iframeReqId,id:t.id};e.postMessage(JSON.stringify(i),"*")})},a.prototype._htmlFragResponseHandler=function(t){if(t.id===this.id){var e=null!=t.iframeReqId?t.iframeReqId:0;this._iframeContentRequests[e].resolve(t.value)}},a.prototype._postHtmlFragRequestToIframe=function(t,e){var r={type:"htmlFragRequest",id:this.id,iframeReqId:e,iframeReqTimeout:.6*this.iframeReqTimeout};t.contentWindow.postMessage(JSON.stringify(r),"*");var i=new n.Deferred;this._iframeContentRequests[e]=i,setTimeout(function(){"resolved"!==i.state()&&i.resolve(null)},this.iframeReqTimeout)},r.exports=a}),require.register("scripts/shutterbug",function(t,e,r){function i(t){function e(t){"string"==typeof t?a=t:"function"==typeof t?i=t:"object"==typeof t&&(n=t)}var r,i,a,n={};return 3===t.length?(n=t[2],e(t[1]),r=t[0]):2===t.length?(e(t[1]),r=t[0]):1===t.length&&(n=t[0]),r&&(n.selector=r),i&&(n.done=i),a&&(n.dstSelector=a),n}var a=e("scripts/shutterbug-worker");r.exports={snapshot:function(){var t=i(arguments),e=new a(t);e.getDomSnapshot()},enable:function(t){this.disable(),t=t||"body",this._iframeWorker=new a({selector:t}),this._iframeWorker.enableIframeCommunication()},disable:function(){this._iframeWorker&&this._iframeWorker.disableIframeCommunication()}}}),window.Shutterbug=require("scripts/shutterbug");